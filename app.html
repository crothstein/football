<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayMaker - Flag Football Designer</title>
    <link rel="stylesheet" href="css/style_v17.css?v=23">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Global Error Handler for debugging
        window.onerror = function (msg, url, line, col, error) {
            const div = document.createElement('div');
            div.style.position = 'fixed';
            div.style.top = '0';
            div.style.left = '0';
            div.style.width = '100%';
            div.style.height = '100%';
            div.style.backgroundColor = 'rgba(0,0,0,0.8)';
            div.style.color = 'red';
            div.style.padding = '20px';
            div.style.zIndex = '9999';
            div.style.overflow = 'auto';
            div.style.fontSize = '16px';
            div.style.fontFamily = 'monospace';
            div.innerHTML = `<h3>Application Error</h3>
            <p><strong>Message:</strong> ${msg}</p>
            <p><strong>File:</strong> ${url}:${line}:${col}</p>
            <pre>${error ? error.stack : ''}</pre>`;
            document.body.appendChild(div);
            return false;
        };
        // Catch unhandled promise rejections too
        window.onunhandledrejection = function (event) {
            window.onerror(event.reason.message || 'Unhandled Rejection', '', 0, 0, event.reason);
        };
    </script>
</head>

<body>
    <!-- Global SVG Definitions -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
        <defs>
            <marker id="arrowhead-6366f1" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#6366f1" />
            </marker>
            <marker id="arrowhead-ef4444" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#ef4444" />
            </marker>
            <marker id="arrowhead-22c55e" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#22c55e" />
            </marker>
            <marker id="arrowhead-eab308" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#eab308" />
            </marker>
            <marker id="arrowhead-ec4899" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#ec4899" />
            </marker>
            <marker id="arrowhead-06b6d4" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#06b6d4" />
            </marker>
            <marker id="arrowhead-1f2937" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#1f2937" />
            </marker>
            <!-- New Colors -->
            <marker id="arrowhead-f97316" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#f97316" />
            </marker>
            <marker id="arrowhead-3b82f6" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#3b82f6" />
            </marker>
            <marker id="arrowhead-a855f7" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#a855f7" />
            </marker>
            <marker id="arrowhead-64748b" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#64748b" />
            </marker>
            <!-- Circle Markers (Empty/Stroked) -->
            <marker id="circlehead-6366f1" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#6366f1" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-ef4444" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#ef4444" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-22c55e" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#22c55e" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-eab308" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#eab308" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-ec4899" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#ec4899" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-06b6d4" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#06b6d4" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-1f2937" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#1f2937" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-f97316" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#f97316" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-3b82f6" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#3b82f6" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-a855f7" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#a855f7" stroke-width="0.15" />
            </marker>
            <marker id="circlehead-64748b" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#64748b" stroke-width="0.15" />
            </marker>
            <!-- Black Markers -->
            <marker id="arrowhead-000000" markerWidth="2.5" markerHeight="2.5" refX="2.8" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse" viewBox="0 0 3 3">
                <polygon points="0 0, 3 1.5, 0 3" fill="#000000" />
            </marker>
            <marker id="circlehead-000000" markerWidth="2.5" markerHeight="2.5" refX="1.5" refY="1.5" orient="auto"
                markerUnits="userSpaceOnUse">
                <circle cx="1.5" cy="1.5" r="0.8" fill="#ffffff" stroke="#000000" stroke-width="0.15" />
            </marker>
        </defs>
    </svg>

    <div class="app-container">

        <!-- VIEW: Create Playbook (Modal Style) -->
        <div id="view-create-playbook" class="view-section dark-overlay hidden">
            <div class="modal-container">
                <div class="modal-header">
                    <button id="close-create-modal" class="btn-icon-light">‚úï</button>
                    <h2>NEW PLAYBOOK</h2>
                    <button id="confirm-create-playbook" class="btn-icon-success">‚úì</button>
                </div>
                <div class="modal-body">
                    <div class="modal-field">
                        <label>PLAYBOOK NAME</label>
                        <input type="text" id="new-playbook-name" class="dark-input" placeholder="Playbook Name">
                    </div>

                    <div class="modal-field">
                        <label>GAME FORMAT</label>
                        <div class="team-size-selector" id="team-size-selector">
                            <button class="size-btn active" data-value="5">5v5</button>
                            <button class="size-btn" data-value="6">6v6</button>
                            <button class="size-btn" data-value="7">7v7</button>
                        </div>
                        <input type="hidden" id="selected-team-size" value="5">
                    </div>

                    <!-- Hidden for Logic Safety -->
                    <div class="modal-field" style="display:none;">
                        <div class="field-preview-box"></div>
                    </div>
                </div>
                <!-- Hidden select for back-compat logic until we refactor logic fully -->
                <select id="base-formation-select" style="display:none"></select>
            </div>

            <!-- Link to switch to existing playbooks if user gets stuck? 
                 Mock doesn't show it, but we need a way to "Cancel" or see existing.
                 The "X" button should probably go to Overview/Landing.
            -->
            <div id="existing-playbooks-list" class="hidden"></div> <!-- Keeping hidden for logic preservation -->
        </div>

        <!-- VIEW: Playbook Settings (Modal) -->
        <div id="view-playbook-settings" class="dark-overlay hidden">
            <div class="modal-container settings-modal">
                <div class="modal-header">
                    <h2>Playbook Settings</h2>
                    <button id="close-settings-modal" class="btn-icon-light">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Playbook Name</h3>
                        <div class="modal-field align-left">
                            <input type="text" id="settings-playbook-name" class="dark-input"
                                placeholder="Enter name...">
                        </div>
                    </div>

                    <div class="modal-section">
                        <h3 id="settings-default-formation-title">Default Formation</h3>
                        <div class="formation-preview-container" id="settings-formation-preview">
                            <!-- Field Graphic -->
                            <div class="preview-field-green">
                                <!-- Dynamic SVG will be injected here -->
                                <div class="edit-overlay">
                                    <div class="edit-icon">‚úé</div>
                                    <div>Edit Default Formation</div>
                                </div>
                            </div>
                        </div>
                    </div> <!-- End #sidebar-content -->
                    <small class="text-muted">Click the formation to customize default player positions</small>
                </div>

                <div class="modal-section" id="sharing-section-container">
                    <h3>Sharing</h3>

                    <!-- Owner Display -->
                    <div id="playbook-owner-display" style="margin-bottom: 1rem;">
                        <label
                            style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.25rem; display: block;">Owner</label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span id="owner-name" style="font-weight: 500;"></span>
                            <span
                                style="background: #3b82f6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">OWNER</span>
                        </div>
                    </div>

                    <!-- Shared Users List -->
                    <div id="shared-users-list" style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem; display: block;">Shared
                            With</label>
                        <div id="shares-container">
                            <!-- Shares will be dynamically rendered here -->
                            <p id="no-shares-message" style="color: #94a3b8; font-size: 0.9rem; font-style: italic;">Not
                                shared with anyone yet</p>
                        </div>
                    </div>

                    <!-- Inline Share Form (collapsed by default) -->
                    <div id="share-form-container"
                        style="display: none; margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div class="modal-field align-left">
                            <label
                                style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem; display: block;">Email
                                Address</label>
                            <input type="email" id="share-email-input" class="dark-input"
                                placeholder="email@example.com" style="margin-bottom: 0.75rem;">
                        </div>
                        <div class="modal-field align-left">
                            <label
                                style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem; display: block;">Permission</label>
                            <div class="segmented-control" style="margin-bottom: 0.75rem;">
                                <button class="segment-btn active" data-permission="view" id="share-permission-view">
                                    View Only
                                </button>
                                <button class="segment-btn" data-permission="edit" id="share-permission-edit">
                                    Can Edit
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <button id="cancel-share-btn" class="btn-outline-prof">Cancel</button>
                            <button id="send-share-btn" class="btn-primary-prof">Send</button>
                        </div>
                    </div>

                    <!-- Share Button (only visible to owner) -->
                    <button id="toggle-share-form-btn" class="btn-secondary-outline full-width"
                        style="margin-top: 0.5rem;">
                        + Share with...
                    </button>
                </div>

                <div class="modal-section" id="admin-options-container" style="display:none;">
                    <h3>Admin Options</h3>
                    <div class="modal-field-checkbox">
                        <input type="checkbox" id="settings-is-public">
                        <label for="settings-is-public">Make Public Template</label>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Actions</h3>
                    <button id="btn-copy-playbook" class="btn-secondary-outline full-width"
                        style="margin-bottom: 10px;">
                        Copy Playbook
                    </button>
                    <button id="btn-delete-playbook" class="btn-danger-block">
                        Delete Playbook
                    </button>
                </div>

                <div class="modal-footer">
                    <button id="close-settings-btn" class="btn-outline-prof">Close</button>
                    <button id="save-settings-btn" class="btn-primary-prof">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth View -->
    <div id="view-auth" class="view-section hidden">
        <div class="auth-overlay">
            <div class="auth-card">
                <div class="auth-header">
                    <img src="images/logo.png" alt="Playmaker Logo" class="auth-logo"
                        style="height: 100px; width: auto;">
                </div>

                <!-- Login Form -->
                <div id="form-login" class="auth-form-container">
                    <h2>Log In</h2>
                    <form id="login-form"
                        onsubmit="event.preventDefault(); document.getElementById('btn-login').click();">
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" class="light-input" placeholder="coach@example.com"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" class="light-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                required />
                        </div>
                        <button type="submit" id="btn-login" class="btn-primary full-width">Log In</button>
                    </form>

                    <div class="auth-toggle">
                        Don't have an account? <a href="#" id="link-to-signup">Sign up</a>
                    </div>
                </div>

                <!-- Signup Form -->
                <div id="form-signup" class="auth-form-container hidden">
                    <h2>Sign Up</h2>
                    <form id="signup-form"
                        onsubmit="event.preventDefault(); document.getElementById('btn-signup').click();">
                        <div class="form-group">
                            <label for="signup-name">Full Name</label>
                            <input type="text" id="signup-name" class="light-input" placeholder="John Smith" required />
                        </div>
                        <div class="form-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" class="light-input" placeholder="coach@example.com"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" class="light-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                required />
                        </div>
                        <button type="submit" id="btn-signup" class="btn-primary full-width">Sign Up</button>
                    </form>

                    <div class="auth-toggle">
                        Already have an account? <a href="#" id="link-to-login">Log in</a>
                    </div>
                </div>

                <!-- Email Confirmation Pending View -->
                <div id="form-confirm-email" class="auth-form-container hidden">
                    <div class="confirm-email-content">
                        <div class="confirm-email-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24"
                                fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z">
                                </path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </div>
                        <h2>Check Your Email</h2>
                        <p class="confirm-email-message">We've sent a confirmation link to:</p>
                        <p class="confirm-email-address" id="confirm-email-display">email@example.com</p>
                        <p class="confirm-email-instructions">Click the link in your email to activate your account. If
                            you don't see it, check your spam folder.</p>

                        <div class="confirm-email-actions">
                            <button id="btn-resend-confirmation" class="btn-secondary-outline full-width">
                                Resend Confirmation Email
                            </button>
                        </div>

                        <div class="auth-toggle" style="margin-top: 24px;">
                            <a href="#" id="link-confirm-to-login">‚Üê Back to Login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- VIEW: Playbook Overview -->
    <div id="view-playbook-overview" class="view-section hidden"
        style="position: absolute; top: 0; left: 0; display: flex; width: 100vw; height: 100vh; overflow: hidden; background: var(--bg-app); z-index: 10;">
        <!-- Sidebar -->
        <aside class="sidebar-left modern-sidebar">
            <div class="app-brand-area">
                <img src="images/logo.png" alt="PlayMaker Logo" class="app-logo"
                    style="max-width: 100%; height: auto; padding: 10px;">
            </div>

            <div class="current-playbook-selector">
                <!-- Dropdown style -->
                <button id="switch-playbook-btn" class="playbook-dropdown-btn">
                    <span class="dot-indicator">‚óè</span>
                    <span id="current-playbook-name">Vikings 3/4</span>
                    <span class="chevron">‚ñæ</span>
                </button>
            </div>

            <div class="sidebar-menu hidden">
                <div class="menu-label">MAIN MENU</div>
                <button id="nav-new-play" class="menu-item">
                    <span>+</span> New Play
                </button>
                <button id="nav-edit-formation" class="menu-item secondary">
                    <span>‚öô</span> Default Formation
                </button>
            </div>

            <div class="sidebar-menu hidden">
                <div class="menu-label">TOOLS</div>
                <button class="menu-item disabled">Analytics</button>
                <button class="menu-item disabled">Settings</button>
            </div>
            <div class="sidebar-footer">
                <div class="user-profile" id="user-profile-btn">
                    <div class="user-avatar" id="user-avatar">HC</div>
                    <div class="user-info">
                        <span class="user-name" id="display-user-name">Head Coach</span>
                        <span class="user-email" id="display-user-email">coach@team.com</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Shared Dropdown Menus (visible to both desktop and mobile) -->
        <div id="playbook-dropdown-menu" class="dropdown-menu hidden">
            <div id="dropdown-playbook-list">
                <!-- Playbook items will be injected here -->
            </div>
            <div class="dropdown-divider"></div>
            <button id="dropdown-new-playbook" class="dropdown-item create-new">
                <span>+</span> New Playbook
            </button>
        </div>

        <!-- Top Bar (unified layout - shown on all screen sizes) -->
        <div class="mobile-top-bar">
            <div class="top-bar-left">
                <img src="images/logo.png" alt="FlagSketch" class="top-bar-logo">
                <div class="playbook-title-selector" id="playbook-title-btn">
                    <h1 id="mobile-playbook-name" class="playbook-title">Vikings 3/4</h1>
                    <button class="playbook-dropdown-chevron" aria-label="Select Playbook">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="mobile-actions">
                <button id="mobile-print-btn" class="mobile-icon-btn" title="Print" style="padding: 0;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                </button>
                <button id="mobile-settings-btn" class="mobile-icon-btn" title="Settings">
                    ‚öô
                </button>
                <button id="mobile-new-play-btn" class="btn-primary mobile-new-play"
                    style="font-size: 0.85rem; padding: 0.5rem 0.75rem;">
                    + New Play
                </button>
                <div class="user-button-wrapper">
                    <button id="mobile-user-btn" class="mobile-user-button">
                        <div class="user-avatar-small" id="mobile-user-avatar">HC</div>
                    </button>
                    <div id="user-menu" class="user-menu hidden">
                        <div class="user-menu-info">
                            <div class="user-avatar" id="menu-user-avatar">HC</div>
                            <div class="user-details">
                                <span class="user-name" id="menu-user-name">Coach</span>
                                <span class="user-email" id="menu-user-email">email@example.com</span>
                            </div>
                        </div>
                        <div class="menu-divider"></div>
                        <button id="btn-logout" class="menu-item danger">Log Out</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content-area light-bg">
            <div class="overview-header">
                <div class="header-title-area">
                    <!-- Breadcrumb or Title -->
                    <h1 id="header-playbook-name">Vikings 3/4</h1>
                    <!-- <span class="header-subtitle">Offensive Playbook</span> -->
                </div>
                <div class="header-actions-right">
                    <button id="playbook-settings-btn" class="btn-ghost" title="Playbook Settings"
                        style="font-size: 1.8rem; padding: 0 4px; line-height: 1; border: 1px solid transparent; background: transparent;">‚öô</button>
                    <button id="print-playbook-btn" class="btn-ghost" title="Print Playbook"
                        style="padding: 0 6px; border: 1px solid transparent; background: transparent;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2">
                            </path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                    </button>
                    <button id="header-new-play-btn" class="btn-dark small">+ New Play</button>
                </div>
            </div>

            <div class="filter-bar hidden">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="play-search" placeholder="Search plays...">
                </div>
                <div class="filter-actions">
                    <select id="filter-formation" class="pill-select">
                        <option>All Formations</option>
                    </select>
                    <select id="filter-tags" class="pill-select">
                        <option>All Tags</option>
                    </select>
                </div>
            </div>

            <div id="plays-grid" class="plays-grid">
                <!-- Plays rendered here -->
            </div>
        </div>
    </div>

    <!-- VIEW: Play Editor -->
    <div id="view-play-editor" class="view-section hidden">
        <!-- Top Bar: Navigation & Play Info -->
        <header class="top-bar">
            <button id="back-to-book" class="btn-ghost">‚Üê Back</button>
            <div class="play-info">
                <input type="text" id="play-name" value="New Play" placeholder="Untitled Play">
                <h2 id="formation-editor-title" style="display:none; margin: 0; color: #fff;">Default Formation</h2>
            </div>
            <div class="actions">
                <button id="btn-play-details" class="btn-ghost" title="Play Settings"
                    style="margin-right: 10px; font-size: 1.8rem; padding: 0 4px; line-height: 1;">
                    ‚öô
                </button>

                <button id="toggle-lock-btn" class="btn-primary" title="Toggle Lock">
                    <span class="lock-text">Edit</span>
                </button>
            </div>
        </header>

        <!-- Main Workspace -->
        <div class="workspace-flex"
            style="display: flex !important; flex-direction: row !important; flex: 1 !important; height: calc(100vh - 60px); overflow: hidden; position: relative;">
            <!-- Center: Canvas -->
            <main class="canvas-area-expanded"
                style="flex: 1; background: #f1f5f9; overflow: auto; display: flex; align-items: center; justify-content: center;">
                <!-- Play Canvas Wrapper for responsive sizing -->
                <div style="width: 100%; max-width: 1200px; padding: 2rem; margin: 0 auto; position: relative;">
                    <svg id="play-canvas" viewBox="0 0 100 70" preserveAspectRatio="xMidYMid meet"
                        xmlns="http://www.w3.org/2000/svg"
                        style="width: 100%; height: auto; background: white; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);">
                        <!-- Layers: Field, Routes, Players -->
                        <g id="field-layer"></g>
                        <g id="routes-layer"></g>
                        <g id="icons-layer"></g>
                        <g id="players-layer"></g>
                    </svg>
                </div>
            </main>

            <!-- Right Sidebar: Properties -->
            <aside id="editor-sidebar-right" class="editor-sidebar hidden"
                style="width: 300px !important; min-width: 300px !important; max-width: 300px !important; background: white; border-left: 1px solid #e2e8f0; display: flex; flex-direction: column; overflow-y: auto; padding: 1rem; gap: 1.5rem; flex-shrink: 0 !important;">

                <!-- Empty State -->
                <div id="sidebar-empty-state"
                    style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: #94a3b8; font-size: 1.25rem; font-weight: 500;">
                    Select a player to edit
                </div>

                <!-- Content Wrapper -->
                <div id="sidebar-content" class="hidden">
                    <!-- Header -->
                    <div class="sidebar-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600;">Edit Player</h3>
                        <button id="close-sidebar" class="btn-icon-light"
                            style="cursor: pointer; color: #94a3b8;">‚úï</button>
                    </div>

                    <!-- Player Profile (Preview + Label) -->
                    <div class="player-profile-section"
                        style="display: flex; align-items: center; gap: 1rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1.5rem;">
                        <!-- Preview Circle -->
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <!-- Invisible Spacer Label -->
                            <label style="font-size: 0.8rem; margin-bottom: 2px; visibility: hidden;">.</label>
                            <div id="prop-player-preview"
                                style="width: 48px; height: 48px; border-radius: 50%; background: #3b82f6; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem; flex-shrink: 0; border: 2px solid var(--text-main);">
                                P
                            </div>
                        </div>
                        <!-- Input Column -->
                        <div style="display: flex; flex-direction: column;">
                            <label style="font-size: 0.8rem; color: #64748b; margin-bottom: 2px;">Label</label>
                            <input type="text" id="prop-player-label" class="minimal-input" placeholder="--"
                                maxlength="2"
                                style="font-size: 1.1rem; font-weight: 600; border: none; border-bottom: 2px solid #e2e8f0; padding: 2px 0; width: 60px; outline: none; color: #0f172a; background: transparent;">
                        </div>

                        <!-- Primary Toggle -->
                        <div style="display: flex; flex-direction: column; margin-left: auto; align-items: center;">
                            <label style="font-size: 0.8rem; color: #64748b; margin-bottom: 2px;">Make Primary</label>
                            <button id="make-primary-btn" class="btn-icon-light" title="Toggle Primary Player (Star)"
                                style="width: 36px; height: 36px; border: 1px solid #e2e8f0; color: #cbd5e1;">
                                ‚òÖ
                            </button>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="sidebar-section" style="margin-top: 0.5rem; border-top: none;">
                        <label style="margin-bottom: 0.75rem; display: block; margin-top: 1rem;">Actions</label>
                        <div class="action-buttons-row">
                            <button id="undo-change" class="btn-secondary-outline full-width">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="0.15" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 14L4 9l5-5" />
                                    <path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11" />
                                </svg>
                                Undo
                            </button>
                            <button id="delete-element" class="btn-danger-outline full-width">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444"
                                    stroke-width="0.15" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>

                    <!-- Colors -->
                    <div class="sidebar-section">
                        <label style="margin-top: 1rem; display: block;">Player Color</label>
                        <div class="color-grid-large"
                            style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem;">
                            <button class="color-btn-lg" style="background: #ef4444" data-color="#ef4444"></button>
                            <button class="color-btn-lg" style="background: #f97316" data-color="#f97316"></button>
                            <button class="color-btn-lg" style="background: #eab308" data-color="#eab308"></button>
                            <button class="color-btn-lg" style="background: #22c55e" data-color="#22c55e"></button>
                            <button class="color-btn-lg" style="background: #3b82f6" data-color="#3b82f6"></button>
                            <button class="color-btn-lg" style="background: #a855f7" data-color="#a855f7"></button>
                            <button class="color-btn-lg" style="background: #ec4899" data-color="#ec4899"></button>
                            <button class="color-btn-lg" style="background: #000000" data-color="#000000"></button>
                        </div>
                    </div>

                    <!-- Route Cuts Style -->
                    <div class="sidebar-section">
                        <label style="margin-top: 1rem; display: block;">Route Cuts</label>
                        <div class="segmented-control">
                            <button class="segment-btn active" data-cut="hard" id="route-cut-hard">
                                üìê Hard
                            </button>
                            <button class="segment-btn" data-cut="rounded" id="route-cut-rounded">
                                ‚ó† Round
                            </button>
                        </div>
                    </div>

                    <!-- Route End Style -->
                    <div class="sidebar-section">
                        <label style="margin-top: 1rem; display: block;">Route End</label>
                        <div class="segmented-control">
                            <button class="segment-btn active" data-end="arrow" id="route-end-arrow">
                                ‚Üí Arrow
                            </button>
                            <button class="segment-btn" data-end="circle" id="route-end-circle">
                                ‚óã Circle
                            </button>
                        </div>
                    </div>

                    <!-- Route Segments Style -->
                    <div class="sidebar-section">
                        <label style="margin-top: 1rem; display: block;">Route Styles</label>
                        <div id="route-segments-container" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <!-- Dynamic Segments -->
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <!-- VIEW: Play Settings Modal -->
    <div id="modal-play-settings" class="dark-overlay hidden">
        <div class="modal-container settings-modal">
            <div class="modal-header">
                <h2>Play Details</h2>
                <button id="close-play-settings" class="btn-icon-light">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3>Play Name</h3>
                    <div class="modal-field align-left">
                        <input type="text" id="setting-play-name" class="light-input-bg"
                            placeholder="Enter play name...">
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Description</h3>
                    <div class="modal-field align-left">
                        <textarea id="setting-play-desc" class="light-input-bg" rows="4"
                            placeholder="Describe the play's strategy..."></textarea>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Actions</h3>
                    <div class="action-buttons-row">
                        <button type="button" id="btn-copy-play" class="btn-secondary-outline full-width">
                            Duplicate Play
                        </button>
                    </div>
                    <div class="action-buttons-row" style="margin-top: 10px;">
                        <button type="button" id="btn-delete-play" class="btn-danger-block full-width">
                            Delete Play
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary-prof" id="save-play-settings">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (replaces native confirm) -->
    <div id="modal-confirm" class="dark-overlay hidden">
        <div class="modal-container" style="max-width: 400px; text-align: center;">
            <div class="modal-header" style="justify-content: center; border-bottom: none; padding-bottom: 0;">
                <h2 id="confirm-title">Confirm Action</h2>
            </div>
            <div class="modal-body" style="padding: 1rem 1.5rem;">
                <p id="confirm-message" style="color: var(--text-muted); margin: 0;">Are you sure?</p>
            </div>
            <div class="modal-footer" style="justify-content: center; gap: 1rem; border-top: none; padding-top: 0;">
                <button type="button" id="confirm-cancel" class="btn-secondary-outline">Cancel</button>
                <button type="button" id="confirm-ok" class="btn-danger-block">Delete</button>
            </div>
        </div>
    </div>

    <!-- VIEW: Print Settings Modal -->
    <div id="view-print-settings" class="dark-overlay hidden">
        <div class="modal-container settings-modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Print Playbook</h2>
                <button id="close-print-modal" class="btn-icon-light">‚úï</button>
            </div>

            <!-- Print Tabs -->
            <div class="print-tabs" style="display: flex; border-bottom: 1px solid #e2e8f0; margin-bottom: 20px;">
                <button class="print-tab active" data-tab="wristband"
                    style="flex: 1; padding: 12px; background: none; border: none; color: var(--text-main); border-bottom: 2px solid #3b82f6; cursor: pointer; font-weight: 600;">Wristbands</button>
                <button class="print-tab" data-tab="playbook"
                    style="flex: 1; padding: 12px; background: none; border: none; color: var(--text-muted); border-bottom: 2px solid transparent; cursor: pointer; font-weight: 600;">Playbook</button>
            </div>

            <div class="modal-body">
                <div class="print-info-summary"
                    style="margin-bottom: 20px; color: var(--text-muted); font-size: 0.9rem;">
                    Printing <span id="print-play-count-display">0</span> plays from current playbook.
                </div>

                <!-- WRISTBAND OPTIONS -->
                <div id="print-options-wristband" class="print-options-section">
                    <div class="modal-section">
                        <label
                            style="display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px;">Layout</label>
                        <div class="segmented-control" style="width: 100%;">
                            <button class="segment-btn active" data-plays="8">8 Plays</button>
                            <button class="segment-btn" data-plays="6">6 Plays</button>
                            <button class="segment-btn" data-plays="4">4 Plays</button>
                        </div>
                    </div>

                    <div class="modal-section">
                        <label
                            style="display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px;">Width</label>
                        <div class="wristband-width-selector segmented-control" style="width: 100%;">
                            <button class="segment-btn active" data-width="3">3"</button>
                            <button class="segment-btn" data-width="3.25">3.25"</button>
                            <button class="segment-btn" data-width="3.5">3.5"</button>
                            <button class="segment-btn" data-width="3.75">3.75"</button>
                            <button class="segment-btn" data-width="4">4"</button>
                            <button class="segment-btn" data-width="4.25">4.25"</button>
                            <button class="segment-btn" data-width="4.5">4.5"</button>
                            <button class="segment-btn" data-width="4.75">4.75"</button>
                            <button class="segment-btn" data-width="5">5"</button>
                        </div>
                    </div>

                    <div class="modal-section">
                        <label
                            style="display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px;">Height</label>
                        <div class="wristband-height-selector segmented-control" style="width: 100%;">
                            <button class="segment-btn" data-height="2">2"</button>
                            <button class="segment-btn active" data-height="2.25">2.25"</button>
                            <button class="segment-btn" data-height="2.5">2.5"</button>
                            <button class="segment-btn" data-height="2.75">2.75"</button>
                            <button class="segment-btn" data-height="3">3"</button>
                            <button class="segment-btn" data-height="3.5">3.5"</button>
                        </div>
                    </div>
                </div>

                <!-- PLAYBOOK OPTIONS -->
                <div id="print-options-playbook" class="print-options-section hidden">
                    <div class="modal-section">
                        <label style="display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px;">Plays per
                            Page</label>
                        <div class="segmented-control" style="width: 100%;">
                            <button class="segment-btn" data-plays="24">24</button>
                            <button class="segment-btn active" data-plays="12">12</button>
                            <button class="segment-btn" data-plays="8">8</button>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn-outline-prof" id="cancel-print-btn">Cancel</button>
                <button class="btn-primary-prof" id="confirm-print-btn">Print</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Hidden Print Container -->
    <div id="print-container"></div>

    <!-- Snackbar for notifications -->
    <div id="snackbar" class="snackbar hidden">Click edit to start making edits</div>
    <script type="module" src="js/formations.js?v=15"></script>
    <script type="module" src="js/store.js?v=19"></script>
    <script type="module" src="js/editor.js?v=15"></script>
    <script type="module" src="js/ui.js?v=28"></script>
    <script type="module" src="js/print.js?v=7"></script> <!-- Fixed header colors with !important -->
    <script type="module" src="js/app.js?v=19"></script>
</body>

</html>